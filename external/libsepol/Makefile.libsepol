CC = $(CROSS_COMPILE)gcc
AR = $(CROSS_COMPILE)ar

TARGET = libsepol
TARGET_STATIC_LIB = $(TARGET).a

SRC = assertion.c \
	avrule_block.c \
	avtab.c \
	boolean_record.c \
	booleans.c \
	conditional.c \
	constraint.c \
	context.c \
	context_record.c \
	debug.c \
	ebitmap.c \
	expand.c \
	genbools.c \
	genusers.c \
	handle.c \
	hashtab.c \
	hierarchy.c \
	iface_record.c \
	interfaces.c \
	link.c \
	mls.c \
	module.c \
	node_record.c \
	nodes.c \
	polcaps.c \
	policydb.c \
	policydb_convert.c \
	policydb_public.c \
	port_record.c \
	ports.c \
	roles.c \
	services.c \
	sidtab.c \
	symtab.c \
	user_record.c \
	users.c \
	util.c \
	write.c

OBJ = $(SRC:.c=.o)

CFLAGS = -Wall -W -Wundef \
	-Wshadow -Wmissing-noreturn	-Wmissing-format-attribute
CFLAGS += -I./include -I./src

$(TARGET_STATIC_LIB):$(OBJ);$(AR) -r $(TARGET_STATIC_LIB) $(OBJ)
$(filter %.o,$(OBJ)):%.o:src/%.c;$(CC) $(CFLAGS) -c -o $@ $<

.PHONY:install
install:
	 mv $(TARGET_STATIC_LIB) ../../output/lib/

.PHONY:clean
clean:
	 rm -f $(OBJ) $(TARGET_STATIC_LIB)
